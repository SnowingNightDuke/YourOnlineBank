package yob.mbeans;

import java.util.List;

import javax.ejb.EJB;
import javax.enterprise.context.RequestScoped;
import javax.inject.Named;

import yob.controller.TransactionContainer;
import yob.repository.AccountRepository;
import yob.repository.TransactionRepository;
import yob.repository.UserRepository;
import yob.repository.entities.Account;
import yob.repository.entities.Transaction;
import yob.util.FacesContextUtils;

@Named("transactionMbean")
@RequestScoped
public class TransactionMbean {
	@EJB
	TransactionRepository transactionRepository;
	@EJB
	UserRepository userRepository;
	
	private Transaction convertTransactionToEntity(TransactionContainer localTransaction) {
		Transaction transaction = new Transaction(); //entity
        int transactionNo = localTransaction.getTransactionNo();
        double amount = localTransaction.getAmount();
        String type = localTransaction.getType();
        Account payerAccount = localTransaction.getPayerAccount();
        Account payeeAccount = localTransaction.getPayeeAccount();
        transaction.setTransactionNo(transactionNo);
        transaction.setAmount(amount);
        transaction.setType(type);
        transaction.setPayeeAccount(payeeAccount);
        transaction.setPayerAccount(payerAccount);
        transaction.setDescription(localTransaction.getDescription());
        
        return transaction;
	}
	
	public void addTransaction(TransactionContainer t) throws Exception {
		Transaction transaction = convertTransactionToEntity(t);
		transactionRepository.add(transaction);
	}
    public List<Transaction> getAllTransactions() throws Exception{
        return transactionRepository.findAll();
    }
    public Transaction getTransactionByNo(String no) throws Exception{
        return transactionRepository.findByNo(no);
    }
    }
    public void removeTransactionByNo(String no) throws Exception{
        transactionRepository.del(no);
    }
    public void editTransaction(Transaction t) throws Exception{
            transactionRepository.update(t);
            FacesContextUtils.showMessage("Successfully edited");
    }
}